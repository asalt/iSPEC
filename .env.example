# Example environment configuration for the iSPEC toolkit.
# Copy this file to `.env` (or export the variables another way) and adjust the
# paths for your deployment.

# Base directory where SQLite database files are stored.
ISPEC_DB_DIR=/var/lib/ispec

# Optional explicit path to the primary SQLite database file. When left
# commented, iSPEC defaults to "$ISPEC_DB_DIR/ispec.db".
#ISPEC_DB_PATH=/var/lib/ispec/ispec.db

# Optional explicit path to the schedule SQLite database file. When left
# commented, iSPEC defaults to alongside ISPEC_DB_PATH as `ispec-schedule.db`.
#ISPEC_SCHEDULE_DB_PATH=/var/lib/ispec/ispec-schedule.db

# Optional explicit path to the omics SQLite database file. When left
# commented, iSPEC defaults to alongside ISPEC_DB_PATH as `ispec-omics.db`.
#ISPEC_OMICS_DB_PATH=/var/lib/ispec/ispec-omics.db

# Optional explicit path to the support assistant SQLite database file. When left
# commented, iSPEC defaults to alongside ISPEC_DB_PATH as `ispec-assistant.db`.
#ISPEC_ASSISTANT_DB_PATH=/var/lib/ispec/ispec-assistant.db

# Directory for log files written by the logging helpers and CLI commands.
ISPEC_LOG_DIR=/var/log/ispec

# Location for the JSON logging configuration managed by `ispec logging`.
ISPEC_CONFIG_DIR=/etc/ispec
ISPEC_LOG_CONFIG=/etc/ispec/logging.json

# Directory used by the API CLI to persist state about running servers.
ISPEC_STATE_DIR=/var/lib/ispec/state

# Optional override for the API server state file path.
#ISPEC_API_STATE_FILE=/var/lib/ispec/state/api_server.json

# ---------------------------------------------------------------------------
# API security + exposure controls
# ---------------------------------------------------------------------------

# Optional shared API key for the FastAPI service.
# When set, requests must include either:
#   - X-API-Key: <value>
#   - Authorization: Bearer <value>
#
# The CLI refuses to start the API bound to a non-local interface unless this
# is set (e.g. --host 0.0.0.0).
#ISPEC_API_KEY=change-me

# When truthy, return 503 if ISPEC_API_KEY is not set.
#ISPEC_API_REQUIRE_KEY=1

# Comma-separated list of resource prefixes to expose (without leading slash).
# Use "all" or "*" to expose everything wired into the API router.
# Defaults to: projects,people,project_comment
#ISPEC_API_RESOURCES=projects,people,project_comment

# Set to 0 to disable legacy root routes like /projects (keep only /api/projects).
#ISPEC_API_LEGACY_ROOT_ROUTES=0

# Comma-separated list of allowed CORS origins for browser clients.
# Defaults include localhost + 127.0.0.1 for ports 3000 and 5173.
#ISPEC_CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# Allow cookies/credentials in CORS (only enable when you intentionally use
# cookie-based auth).
#ISPEC_CORS_ALLOW_CREDENTIALS=1

# Require users to log in (cookie session) for protected CRUD routes.
#ISPEC_REQUIRE_LOGIN=1

# Optional dev-only default admin user.
# - Ensures the configured username exists and has role=admin.
# - Can optionally reset the password on every startup (dangerous outside dev).
# Do NOT enable this in shared environments unless you also set ISPEC_API_KEY.
#ISPEC_DEV_DEFAULT_ADMIN=1
#ISPEC_DEV_ADMIN_USERNAME=admin
#ISPEC_DEV_ADMIN_PASSWORD=change-me
#ISPEC_DEV_ADMIN_RESET_PASSWORD=1

# PBKDF2 password hashing settings
#ISPEC_PASSWORD_PEPPER=change-me-too
#ISPEC_PASSWORD_ITERATIONS=250000

# Cookie session settings
#ISPEC_SESSION_COOKIE_NAME=ispec_session
#ISPEC_SESSION_TTL_SECONDS=43200
#ISPEC_SESSION_COOKIE_SAMESITE=lax
#ISPEC_SESSION_COOKIE_SECURE=0

# ---------------------------------------------------------------------------
# Legacy sync (FileMaker API)
# ---------------------------------------------------------------------------

# Base URL for the legacy API (e.g. http://10.16.1.32:8000).
# Alternatively, set ~/.ispec/ispec.conf with url/user/pw.
#ISPEC_LEGACY_API_URL=
#ISPEC_LEGACY_USER=
#ISPEC_LEGACY_PASSWORD=
# Optional legacy API key header.
#ISPEC_LEGACY_API_KEY=
# When legacy responses drop fields, fetch in small chunks (0 disables).
#ISPEC_LEGACY_FIELDS_CHUNK_SIZE=25

# ---------------------------------------------------------------------------
# Support assistant (chat)
# ---------------------------------------------------------------------------

# Provider for /api/support/chat: stub | ollama | vllm
#ISPEC_ASSISTANT_PROVIDER=ollama

# Assistant display name / identity in the system prompt.
#ISPEC_ASSISTANT_NAME=iSPEC

# Maximum number of recent assistant DB messages to consider when building a prompt.
#ISPEC_ASSISTANT_HISTORY_LIMIT=20

# Prompt budgeting (approximate token estimate); used to trim history.
#ISPEC_ASSISTANT_MAX_PROMPT_TOKENS=6000

# Rolling summary stored in the assistant DB session state.
# Set to 0 to disable summarization.
#ISPEC_ASSISTANT_SUMMARY_MAX_CHARS=2000

# Allow the assistant to request on-demand DB lookups via TOOL_CALL.
#ISPEC_ASSISTANT_MAX_TOOL_CALLS=2

# Tool protocol for tool calling: line (TOOL_CALL parsing) | openai (tools/tool_calls)
#ISPEC_ASSISTANT_TOOL_PROTOCOL=line

# Optional: run a second internal pass to review/rewrite the final answer (adds latency).
#ISPEC_ASSISTANT_SELF_REVIEW=1

# Optional (experimental): return two draft answers and prompt the user to pick one.
#ISPEC_ASSISTANT_COMPARE_MODE=1

# Optional (vLLM-only): add a tiny KEEP/REWRITE decider before rewriting
# (reduces review tokens when draft is already good).
#ISPEC_ASSISTANT_SELF_REVIEW_DECIDER=1

# Optional: model sampling temperature (0â€“2). Lower is more deterministic.
#ISPEC_ASSISTANT_TEMPERATURE=0

# Optional (dev-only): enable repo code browsing tools (repo_search/repo_list_files/repo_read_file).
#ISPEC_ASSISTANT_ENABLE_REPO_TOOLS=1
#ISPEC_ASSISTANT_REPO_ROOT=/path/to/ispec-full

# Optional system prompt overrides (useful for prompt iteration without code changes).
#ISPEC_ASSISTANT_SYSTEM_PROMPT_PATH=
#ISPEC_ASSISTANT_SYSTEM_PROMPT=
#ISPEC_ASSISTANT_SYSTEM_PROMPT_EXTRA_PATH=
#ISPEC_ASSISTANT_SYSTEM_PROMPT_EXTRA=

# Ollama provider settings
ISPEC_OLLAMA_URL=http://127.0.0.1:11434
ISPEC_OLLAMA_MODEL=llama3.2:2b
ISPEC_OLLAMA_TIMEOUT_SECONDS=30

# vLLM (OpenAI-compatible) provider settings
#ISPEC_VLLM_URL=http://127.0.0.1:8000
#ISPEC_VLLM_MODEL=allenai/Llama-3.1-Tulu-3-8B
#ISPEC_VLLM_API_KEY=
#ISPEC_VLLM_TIMEOUT_SECONDS=300
