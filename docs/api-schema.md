<!-- This file is generated by docs/generate_api_schema_md.py -->
# API Schema Generation

This document describes how iSPEC derives JSON schemas with UI hints for its CRUD endpoints.

## Overview

When a router is generated for a SQLAlchemy model, three helper functions collaborate:

1. **`make_pydantic_model_from_sqlalchemy`** converts a SQLAlchemy model into a Pydantic model. It walks each mapped column, determines the Python type and whether the field should be optional, and builds a new `BaseModel` subclass for create or read operations.
2. **`build_form_schema`** takes the SQLAlchemy model and the generated Pydantic model and produces a JSON schema for forms. It starts with `CreateModel.model_json_schema()`, then iterates over each property to attach UI metadata and injects top-level ordering and section information.
3. **`ui_from_column`** inspects individual SQLAlchemy `Column` objects to infer UI metadata such as the component type (`Text`, `Textarea`, `Select`, `SelectAsync`, etc.), `optional` flags for nullable fields, `autofill` flags for defaults, or `optionsEndpoint` for foreign keys.

The `/people/schema` endpoint runs these steps for the `Person` model.

## Example `/people/schema` Response

```json
{
  "properties": {
    "ppl_AddedBy": {
      "title": "Ppl Addedby",
      "type": "string",
      "ui": {
        "component": "Textarea"
      }
    },
    "ppl_Name_First": {
      "title": "Ppl Name First",
      "type": "string",
      "ui": {
        "component": "Text"
      }
    },
    "ppl_Name_Last": {
      "title": "Ppl Name Last",
      "type": "string",
      "ui": {
        "component": "Text"
      }
    },
    "ppl_Domain": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Domain",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Email": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Email",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Phone": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Phone",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_PI": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Pi",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Institution": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Institution",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Center": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Center",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Department": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Department",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Status": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Status",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Roles_PI": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Roles Pi",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Roles_CoreUser": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Roles Coreuser",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Roles_CoreStaff": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Roles Corestaff",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Roles_Collaborator": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Roles Collaborator",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_Roles": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Roles",
      "ui": {
        "component": "Textarea",
        "optional": true
      }
    },
    "ppl_CreationTS": {
      "anyOf": [
        {
          "format": "date-time",
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Creationts",
      "ui": {
        "component": "DateTime",
        "autofill": true
      }
    },
    "ppl_ModificationTS": {
      "anyOf": [
        {
          "format": "date-time",
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Ppl Modificationts",
      "ui": {
        "component": "DateTime",
        "autofill": true
      }
    }
  },
  "required": [
    "ppl_AddedBy",
    "ppl_Name_First",
    "ppl_Name_Last"
  ],
  "title": "PersonCreate",
  "type": "object",
  "ui": {
    "title": "Person",
    "order": [
      "ppl_AddedBy",
      "ppl_Name_First",
      "ppl_Name_Last",
      "ppl_Domain",
      "ppl_Email",
      "ppl_Phone",
      "ppl_PI",
      "ppl_Institution",
      "ppl_Center",
      "ppl_Department",
      "ppl_Status",
      "ppl_Roles_PI",
      "ppl_Roles_CoreUser",
      "ppl_Roles_CoreStaff",
      "ppl_Roles_Collaborator",
      "ppl_Roles",
      "ppl_CreationTS",
      "ppl_ModificationTS"
    ],
    "sections": []
  }
}
```

Each field includes a `ui` object describing how it should render, while the root `ui` object provides global hints such as the display title, field order, and optional sections.

